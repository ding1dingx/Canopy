name: Canopy CI

on:
  push:
    branches: [main, master]
    paths-ignore:
      - '**.md'
      - '**.txt'
      - 'docs/**'
      - 'Examples/**'
      - 'README*'
      - 'CONTRIBUTING*'
      - 'TESTING*'
  pull_request:
    branches: [main, master]
    paths-ignore:
      - '**.md'
      - '**.txt'
      - 'docs/**'
      - 'Examples/**'
      - 'README*'
      - 'CONTRIBUTING*'
      - 'TESTING*'

jobs:
  lint:
    name: SwiftLint
    runs-on: macos-15
    steps:
      - uses: actions/checkout@v4

      - name: Setup SwiftLint
        run: brew install swiftlint

      - name: Run SwiftLint
        run: swiftlint

  build-and-test:
    name: Build & Test
    runs-on: macos-15
    steps:
      - uses: actions/checkout@v4

      - name: Build for iOS Simulator
        run: |
          xcodebuild -project Canopy.xcodeproj \
            -scheme Canopy \
            -destination "generic/platform=iOS Simulator" \
            -configuration Debug \
            build \
            CODE_SIGN_IDENTITY="" \
            CODE_SIGNING_REQUIRED=NO \
            CODE_SIGNING_ALLOWED=NO

      - name: Run SPM Tests
        run: swift test

